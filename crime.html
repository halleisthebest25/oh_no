<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Crime Spree</title>
  <style>
    body { font-family: Arial, sans-serif; background:#222; color:#fff; text-align:center; padding:20px }
    h1 { margin-bottom:20px }
    #moneyDisplay { font-size:1.4rem; margin-bottom:20px }
    .section { background:rgba(255,255,255,0.1); padding:15px; margin:15px auto; border-radius:12px; max-width:600px }
    .section h2 { margin-top:0 }
    .section label, .section select, .section input, .section button { display:block; margin:8px auto; }
    .section button { padding:8px 16px; border:none; border-radius:6px; background:#e74c3c; color:#fff; cursor:pointer }
    .section button:disabled { background:#555; cursor:not-allowed }
    #log { margin-top:20px; min-height:40px; color:#f1c40f }
    a { display:block; margin-top:30px; color:#74b9ff }
  </style>
</head>
<body>
  <h1>ðŸ’€ Crime Spree</h1>
  <div id="moneyDisplay">Money: $0</div>

  <!-- Casino Section -->
  <div class="section">
    <h2>Illegal Casino</h2>
    <label>Fairness (0=risky â†’ high profit, 100=safe â†’ low profit):
      <input type="range" id="casinoFairness" min="0" max="100" value="50"/>
      <span id="fairVal">50</span>%
    </label>
    <button id="startCasino">Start Casino ($50 k)</button>
    <button id="retrieveCasino" disabled>Retrieve Profits</button>
    <p>Police chance on retrieve: <span id="policeChance">50%</span></p>
  </div>

  <!-- Drug Section -->
  <div class="section">
    <h2>Drug Operation</h2>
    <label>Workers: <span id="workerCount">0</span> (each produces 1/unit per 10s)</label>
    <button id="hireWorker">Hire Worker ($10 k)</button>

    <label>Drug Type:
      <select id="drugType">
        <option value="cannabis">Cannabis</option>
        <option value="meth">Meth</option>
        <option value="xanax">Xanax</option>
        <option value="ecstasy">Ecstasy</option>
      </select>
    </label>
    <p>Inventory: <span id="drugInventory">0</span> units</p>
    <button id="produceDrugs" disabled>Produce Drugs</button>

    <label>Use Truck:
      <select id="truckType">
        <option value="none">None</option>
        <option value="truckSmall">Small Truck</option>
        <option value="truckMed">Medium Truck</option>
        <option value="truckLarge">Large Truck</option>
      </select>
    </label>
    <button id="deliverDrugs" disabled>Deliver Drugs</button>
  </div>

  <!-- Murder Section -->
  <div class="section">
    <h2>Hitman Contract</h2>
    <button id="getOffer">Get Offer</button>
    <div id="offerArea"></div>

    <label>Choose Tool:
      <select id="murderTool" disabled>
        <option value="knife">Knife</option>
        <option value="gun">Gun</option>
        <option value="driveby">Drive-by</option>
      </select>
    </label>
    <button id="executeHit" disabled>Execute</button>
  </div>

  <div id="log"></div>
  <a href="index.html">â¬… Back to Home</a>

  <script>
    // Load money
    let money = parseFloat(localStorage.getItem('money'))||100000;

    // Casino state
    let casinoRunning = localStorage.getItem('casino_running')==='true';
    let casinoProfits = parseFloat(localStorage.getItem('casino_profits'))||0;

    // Drug state
    let workers = parseInt(localStorage.getItem('drug_workers'))||0;
    // inventory per drug type
    const inv = {
      cannabis: parseInt(localStorage.getItem('cannabis_inventory'))||0,
      meth:     parseInt(localStorage.getItem('meth_inventory'))||0,
      xanax:    parseInt(localStorage.getItem('xanax_inventory'))||0,
      ecstasy:  parseInt(localStorage.getItem('ecstasy_inventory'))||0
    };

    // Truck ownership from blackmarket
    const hasTruck = {
      truckSmall: localStorage.getItem('truckSmall')==='true',
      truckMed:   localStorage.getItem('truckMed')==='true',
      truckLarge: localStorage.getItem('truckLarge')==='true'
    };

    // Murder contract
    let currentOffer = null;

    // UI elements
    const moneyEl = document.getElementById('moneyDisplay'),
          logEl   = document.getElementById('log');

    function updateMoney(){
      moneyEl.innerText = `Money: $${money.toLocaleString()}`;
      localStorage.setItem('money', money.toFixed(2));
    }
    function log(msg){
      logEl.innerText = msg;
      setTimeout(()=>{ if(logEl.innerText===msg) logEl.innerText=''; },5000);
    }

    // --- Casino ---
    const fairness = document.getElementById('casinoFairness'),
          fairVal = document.getElementById('fairVal'),
          policeCh= document.getElementById('policeChance'),
          startBtn= document.getElementById('startCasino'),
          retBtn  = document.getElementById('retrieveCasino');

    function updateCasinoUI(){
      fairVal.innerText = fairness.value;
      policeCh.innerText = (100 - fairness.value) + '%';
      retBtn.disabled = !casinoRunning;
      startBtn.disabled = casinoRunning;
    }
    startBtn.onclick = ()=>{
      if(money<50000) return log('Not enough for casino.');
      money-=50000; updateMoney();
      casinoRunning=true;
      casinoProfits=0;
      localStorage.setItem('casino_running','true');
      localStorage.setItem('casino_profits','0');
      updateCasinoUI();
      log('Casino started.');
    };
    retBtn.onclick = ()=>{
      // generate profits
      const fair = parseInt(fairness.value),
            max = (100-fair)*1000;
      const profit = Math.floor(Math.random()*max);
      casinoProfits += profit;
      localStorage.setItem('casino_profits',casinoProfits);
      // police chance
      if(Math.random() < (100-fair)/100){
        log('Police caught you! Jail 30s.');
        retBtn.disabled=true;
        setTimeout(()=>{
          retBtn.disabled=false; log('Free from jail.');
        },30000);
      } else {
        money += casinoProfits; updateMoney();
        log(`Retrieved $${casinoProfits.toLocaleString()}.`);
        casinoProfits=0; localStorage.setItem('casino_profits','0');
      }
    };
    updateCasinoUI();

    // --- Drug ---
    const workerEl = document.getElementById('workerCount'),
          hireBtn   = document.getElementById('hireWorker'),
          produceBtn= document.getElementById('produceDrugs'),
          invEl     = document.getElementById('drugInventory'),
          typeSel   = document.getElementById('drugType'),
          truckSel  = document.getElementById('truckType'),
          deliverBtn= document.getElementById('deliverDrugs');

    function updateDrugUI(){
      workerEl.innerText = workers;
      const t = typeSel.value;
      invEl.innerText = inv[t];
      produceBtn.disabled = (workers===0);
      // truck options
      [...truckSel.options].forEach(opt=>{
        const k=opt.value;
        if(k!=='none') opt.disabled = !hasTruck[k];
      });
      deliverBtn.disabled = inv[typeSel.value]===0 || truckSel.value==='none';
    }
    hireBtn.onclick = ()=>{
      if(money<10000) return log('Not enough for worker.');
      money-=10000; workers++;
      localStorage.setItem('drug_workers',workers);
      updateMoney(); updateDrugUI();
    };
    produceBtn.onclick = ()=>{
      produceBtn.disabled=true;
      setTimeout(()=>{
        inv[typeSel.value] += workers;
        localStorage.setItem(typeSel.value+'_inventory',inv[typeSel.value]);
        updateDrugUI();
        log(`Produced ${workers} ${typeSel.value}.`);
        produceBtn.disabled=false;
      },10000); // 10s per cycle
    };
    deliverBtn.onclick = ()=>{
      deliverBtn.disabled=true;
      const t = truckSel.value;
      const times = {truckSmall:15000,truckMed:10000,truckLarge:5000}[t];
      const chance = {truckSmall:0.3,truckMed:0.15,truckLarge:0.05}[t];
      setTimeout(()=>{
        if(Math.random()<chance){
          log('Delivery busted!')
          inv[typeSel.value]=0;
        } else {
          const gain = inv[typeSel.value]*100; // price per unit
          money+=gain; updateMoney();
          log(`Delivered ${inv[typeSel.value]} for $${gain}.`);
          inv[typeSel.value]=0;
        }
        localStorage.setItem(typeSel.value+'_inventory',inv[typeSel.value]);
        updateDrugUI();
        deliverBtn.disabled=false;
      },times);
    };
    updateDrugUI();

    // --- Murder ---
    const getOfferBtn = document.getElementById('getOffer'),
          offerArea   = document.getElementById('offerArea'),
          toolSel     = document.getElementById('murderTool'),
          execBtn     = document.getElementById('executeHit');

    function newOffer(){
      const reward = Math.floor(5000 + Math.random()*20000);
      currentOffer = reward;
      offerArea.innerText = `Contract: eliminate target for $${reward}`;
      toolSel.disabled = false;
      execBtn.disabled = false;
    }
    getOfferBtn.onclick = ()=>{
      if(getOfferBtn.disabled) return;
      getOfferBtn.disabled=true;
      newOffer();
      setTimeout(()=>getOfferBtn.disabled=false,30000+Math.random()*20000);
    };
    execBtn.onclick = ()=>{
      const tool = toolSel.value;
      // require tool ownership from blackmarket
      if(!localStorage.getItem(tool)) return log('You donâ€™t own that tool.');
      let chance = 0.6 + (tool==='driveby'?0.1:0);
      if(Math.random()<chance){
        money+=currentOffer; updateMoney();
        log(`Success! Earned $${currentOffer}.`);
      } else {
        const loss = money*0.1;
        money-=loss; updateMoney();
        log(`Failed! Lost $${loss.toFixed(2)}.`);
      }
      currentOffer=null;
      offerArea.innerText='';
      toolSel.disabled=true;
      execBtn.disabled=true;
    };

    // Init
    updateMoney();
  </script>
</body>
</html>
